<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movies</title>
    <link href="https://fonts.googleapis.com/css?family=Courgette|Paytone+One|Montserrat" rel="stylesheet"> 

    <style>

        /*Global Styles*/
        * {
            margin: 0;
            padding: 0;
            -webkit-box-sizing: border-box;
                    box-sizing: border-box;
        }

        html, body {
            height: 100%;
            width: 100%;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
                -ms-flex-align: center;
                    align-items: center;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
                -ms-flex-direction: column;
                    flex-direction: column;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
        }

        button:hover {
            -webkit-box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.2);
                    box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.2);
        }

        a, a:visited {
            text-decoration: none;
            color: rgba(0 ,0, 0, 0.9);
        }

        a:hover {
            color: rgba(0 ,0, 0, 0.6);
            text-decoration: underline;
        }

        footer {
            font-family: "Paytone One";
            padding: 10px 0px;
            color: white;
            background-color:#12161D ;
            width: 100%;
            position: fixed;
            bottom: 0;
            z-index: 10;
            display: none;
        }

        /* Drawer Opener */
        #opener{
            width: 100%;
            margin-top: -30px;
            -webkit-box-sizing: unset;
                    box-sizing: unset;
            padding-bottom: 7px;
            z-index: 4;
            cursor: pointer;
            -webkit-transition: margin-top 0.2s ease-in-out;
            -o-transition: margin-top 0.2s ease-in-out;
            transition: margin-top 0.2s ease-in-out;
        }

        #open {
            height: 20px;
            width: 20px;
            margin: 0 auto;
            -webkit-transform: rotate(180deg);
                -ms-transform: rotate(180deg);
                    transform: rotate(180deg);
        }


        /* Back to top button */
        #backToTop {
            text-decoration: none;
            cursor: pointer;
            color: white;
            position: fixed;
            right: 50px;
            bottom: 50px;
            z-index: 10;
            background-color: rgba(0 ,0, 0, 0.6);
            padding: 20px;
            border-radius: 5px;
        }

        /* Reset Search button */
        #goBack {
            border: 1px solid #999;
            background-color: #999;
            color: white;
        }


        /*Top Container*/
        #upper-container {
            position: relative;
            top: 0px;
            -webkit-transition: top 0.2s ease-in-out;
            -o-transition: top 0.2s ease-in-out;
            transition: top 0.2s ease-in-out;
            width: 100vw;
            padding-bottom: 50px;
            -webkit-box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.12);
                    box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.12);
            z-index: 3;
        }


        /*Loader Styles*/
        #loader-container {
            height: 100%;
            width: 100%;
            top: 0;
            left: 0;
            position: absolute;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
                -ms-flex-pack: center;
                    justify-content: center;
            -webkit-box-align: center;
                -ms-flex-align: center;
                    align-items: center;
            background-color: transparent;
            display: flex;
            z-index: 10;
        }

        #loader {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border-top: 5px solid #67e2ef;
            border-left: 5px solid #67e2ef;
            border-bottom: 5px solid #67e2ef;
            border-right: 5px solid transparent;
            -webkit-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                    transform: rotate(0deg);
            -webkit-animation: spin 1s linear infinite;
                    animation: spin 1s linear infinite;
        }

        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
                        transform: rotate(0deg);
            }
            40% {
                -webkit-transform: rotate(70deg);
                        transform: rotate(70deg);
            }
            60% {
                -webkit-transform: rotate(290deg);
                        transform: rotate(290deg);
            }
            100%{
                -webkit-transform: rotate(360deg);
                        transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
                        transform: rotate(0deg);
            }
            40% {
                -webkit-transform: rotate(70deg);
                        transform: rotate(70deg);
            }
            60% {
                -webkit-transform: rotate(290deg);
                        transform: rotate(290deg);
            }
            100%{
                -webkit-transform: rotate(360deg);
                        transform: rotate(360deg);
            }
        }



        /* Search Bar */
        input[type="text"] {
            margin-top: 25px;
            outline: none;
            height: 40px;
            width: 420px;
            border: none;
            border-radius: 20px;
            -webkit-box-sizing: border-box;
                    box-sizing: border-box;
            padding: 0 25px;
            font-family: 'Montserrat', sans-serif;
            letter-spacing: 1px;
            cursor: pointer;
            -webkit-box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.12);
                    box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.12);
        }

        #input-container {
            position: relative;
            margin: 0 auto;
            width: 420px;
            display: inline-block;
        }

        #options {
            display: inline-block;
        }


        /*Auto Completion Styles*/
        .autocomplete-items {
            position: absolute;
            border: 1px solid rgba(0 ,0, 0, 0.08);
            border-radius: 10px;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            width: 420px;
            top: 110%;
            left: 0;
            right: 0;
        }

        .autocomplete-items div, .filter-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #fff; 
            border-bottom: 1px solid rgba(0 ,0, 0, 0.08); 
        }

        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }

        .autocomplete-active {
            background-color: #67e2ef !important; 
            color: #ffffff; 
        }


        /* Sorting & Filter Options */
        .sub-options {
            margin: 30px 30px 0px 30px;
            display: inline-block;
        }

        .sort, .filter {
            font-family: "Montserrat", sans-serif;
            outline: none;
            padding: 10px 0px;
            width: 130px;
            border: 1px solid #66e888;
            background-color: white;
            margin-left: 20px;
            cursor: pointer;
            border-radius: 20px;
            -webkit-box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.12);
                    box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.12);
            -webkit-transition: background-color 0.2s ease-in;
                -o-transition: background-color 0.2s ease-in;
                    transition: background-color 0.2s ease-in; 
        }

        .sort {
            border: 1px solid #66e888;
        }

        .filter {
            border: 1px solid #67e2ef;
        }

        .active {
            background-color: #66e888;
        }


        /* Filter Styling */
        .filter-items {
            position: absolute;
            border: 1px solid rgba(0 ,0, 0, 0.08);
            border-radius: 10px;
            border-bottom: none;
            border-top: none;
            z-index: 101;
            width: 130px;
            top: 110%;
            left: -15px;
            display: none;
        }

        .filter-items div:hover {
            background-color: #67e2ef;
        }



        /*Styling For Movie Section*/
        section {
            padding: 70px 0px 200px 0;
            width: 100%;
            min-height: 500px;
            height: auto;
            z-index: 1;
            background-color: #eee;
            overflow: scroll;
            -webkit-transition: top 0.2s ease-in-out;
            -o-transition: top 0.2s ease-in-out;
            transition: top 0.2s ease-in-out;
        }

        section::-webkit-scrollbar {
            width: 4px;
            right: 15px;
            width: 10px;
        }

        section::-webkit-scrollbar-track { 
            border-radius: 10px;
        }

        section::-webkit-scrollbar-thumb {
            border-radius: 10px;
            background-color: rgba(0,0,0,0.4);
        }

        section::-webkit-scrollbar-corner {
            display: none;
        }


        /* Card Styles */
        .movie-card {
            max-height: 90px;
            width: 95%;
            border-radius: 5px;
            background-color: white;
            cursor: pointer;
            -webkit-box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.12);
                    box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.12);
            margin: 0 auto;
            margin-bottom: 7px;
            text-align: left;
            position: relative;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-wrap: wrap;
                flex-wrap: wrap;
            -webkit-box-orient: horizontal;
            -webkit-box-direction: normal;
                -ms-flex-flow: row wrap;
                    flex-flow: row wrap;
            overflow: hidden;
            -webkit-transition: max-height 0.5s ease-out;
            -o-transition: max-height 0.5s ease-out;
            transition: max-height 0.5s ease-out;
        }

        .movie-card:hover {
            -webkit-box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.3);
                    box-shadow: 2px 7px 20px rgba(0 ,0, 0, 0.3);
        }



        /* Styling Card Content */
        .serial {
            top: 0;
            left: 0;
            position: absolute;
            height: 100%;
            width: 50px;
            -webkit-box-sizing: border-box;
                    box-sizing: border-box;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
                -ms-flex-pack: center;
                    justify-content: center;
            -webkit-box-align: center;
                -ms-flex-align: center;
                    align-items: center;
            background-color: #999;
            font-weight: bold;
            color: white;
        }

        .name {
            font-weight: bold;
            opacity: 0.9;
            width: auto;
            height: 90px;
            padding-top: 33px;
            padding-left: 70px;
            -webkit-box-sizing: border-box;
                    box-sizing: border-box;
            /*background-color: #66e888;*/
            -webkit-box-flex: 1;
                -ms-flex: 1 0 50%;
                    flex: 1 0 50%;
        }

        .genre {
            /*background-color: yellowgreen;*/
            width: 40%;
            padding-top: 33px;
            -webkit-box-sizing: border-box;
                    box-sizing: border-box;
            padding-right: 20px;
            font-size: 13px;
            opacity: 0.6;
            height: 90px;
            word-wrap: break-word;
        }

        .actors, .director {
            /*background-color: yellowgreen;*/
            -webkit-box-flex: 1;
                -ms-flex: 1 0 33%;
                    flex: 1 0 33%;
            padding-top: 33px;
            padding-left: 70px;
            height: 90px;
            margin-top: -20px;
            -webkit-box-sizing: border-box;
                    box-sizing: border-box;
            padding-right: 20px;
            font-size: 13px;
            opacity: 0.6;
            word-wrap: break-word;
            border-right: 1px solid rgba(0 ,0, 0, 0.12);
        }

        .actors {
            border: none;
        }

        .budget {
            border-right: 1px solid rgba(0 ,0, 0, 0.12);
        }

        .lang, .country, .budget, .link {
            -webkit-box-flex: 1;
                -ms-flex: 1 0 33%;
                    flex: 1 0 33%;
            padding-top: 33px;
            -webkit-box-sizing: border-box;
                    box-sizing: border-box;
            margin-top: -20px;
            padding-left: 20px;
            font-size: 13px;
            opacity: 0.6;
            height: 90px;
            word-wrap: break-word;
        }

        .budget, .link, .director {
            margin-top: -60px;
            padding-top: 45px;
        }


        /* BreakPoint - 1*/
        @media screen and (max-width: 865px) {
            
        }

        /*Tablets*/
        @media screen and (max-width: 700px) {
            .actors, .lang, .country, .budget, .link, .director {
                font-size: 7px;
            }
            .actors, .director {
                padding-left: 70px;
            }
        }

        /*Cellphones*/
        @media screen and (max-width: 470px) {

            .filter-items {
                -webkit-transform: scale(0.8);
                    -ms-transform: scale(0.8);
                        transform: scale(0.8);
                top: 0;
            }

            .modal {
                -webkit-transform: scale(0.8);
                    -ms-transform: scale(0.8);
                        transform: scale(0.8);
            }

            section {
                padding-top: 30px;
            }

            span {
                font-size: 12px;
            }

            input[type="text"] {
                margin-top: 25px;
                width: 300px;
            }

            .autocomplete-items, #input-container {
                width: 300px;
            }

            .sub-options {
                margin: 30px 0 0 0;
            }

            .sort, .filter {
                -webkit-transform: scale(0.7);
                    -ms-transform: scale(0.7);
                        transform: scale(0.7);
                margin-left: -10px;
            }

            .serial {
                width: 0px;
                padding: 33px 15px;
                font-size: 13px;
            }

            .name {
                min-width: 160px;
                font-size: 12px;
                padding-top: 33px;
                padding-left: 45px;
                
            }
            .genre{
                font-size: 10px;
            }
            .actors, .director {
                padding-left: 45px;
            }

        }



        /* My styles */

        #me {
            position: fixed;
            z-index: 10;
            height: 150px;
            width: 150px;
            background-color: #12161D;
            color: white;
            font-family: "Paytone One";
            font-size: 20px;
            border-radius: 50%;
            padding-top: 20px;
            bottom: -95px;
            cursor: pointer;
            -webkit-transition: bottom 0.6s ease-in;
            -o-transition: bottom 0.6s ease-in;
            transition: bottom 0.6s ease-in;
        }

        #me:hover {
            bottom: -75px;
        }

        .backdrop {
            z-index: 101;
            width: 100%;
            height: 100%;
            position: absolute;
            display: none;
            -webkit-box-pack: center;
                -ms-flex-pack: center;
                    justify-content: center;
            -webkit-box-align: center;
                -ms-flex-align: center;
                    align-items: center;
            background-color: rgba(0 ,0, 0, 0.2);
        }

        .modal {
            z-index: 101;
            width: 400px;
            height: 500px;
            background-color: white;
            -webkit-box-shadow: 2px 10px 30px rgba(0 ,0, 0, 0.2);
                    box-shadow: 2px 10px 30px rgba(0 ,0, 0, 0.2);
            border-radius: 20px;
            text-align: center;
            padding-top: 70px;
        }

        .showoff, .showoff:visited {
            margin-top: 25px;
            padding: 20px 35px;
            cursor: pointer;
            background-color: #12161D;
            color: white;
            font-family: "Montserrat";
            -webkit-box-shadow: 2px 10px 25px rgba(0 ,0, 0, 0.12);
                    box-shadow: 2px 10px 25px rgba(0 ,0, 0, 0.12);
        }

        .showoff:hover {
            text-decoration: none;
            background-color: white;
            color: #12161D;
            -webkit-transition: background-color 0.2s linear, color 0.2s linear;
            -o-transition: background-color 0.2s linear, color 0.2s linear;
            transition: background-color 0.2s linear, color 0.2s linear;
        }



        #weather {
            background-color: #50acb6;
        }

        #weather:hover {
            background-color: white;
        }

        #github {
            padding: 20px 46.5px;
            color: white;
        }

    </style>

</head>
<body>
    <div id="upper-container" class="nav-down">
        <div id="input-container">
            <input type="text" name="search" id="search" placeholder="Search...">
        </div>
        <div id="options">
            <div class="sub-options">
                <span><b>Sort By</b></span>
                <button id="popular" class="sort active">Most Popular</button>
                <button id="latest" class="sort">Latest</button>
            </div>
            <div class="sub-options">
                <span><b>Filter By</b></span>
                <div style="position: relative; display: inline-block"></div>
                    <button id="lang" class="filter">Language</button>
                    <div class="filter-items"></div>
                </div>
                <div style="position: relative; display: inline-block">
                    <button id="country" style="margin-left: -15px" class="filter">Country</button>
                    <div class="filter-items"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="opener">
        <img src="https://files.fm/thumb_show.php?i=88xamb77" alt="OPEN" id="open">
    </div>
    <section>
        <!-- Dynamically added content -->
    </section>
    
    <div id="backToTop">Top</div>
    
    <div id="loader-container">
        <div id="loader"></div>
    </div>

    <div id="me">Me</div>

    <!-- BackDrop & Modal for show Off -->
    <div class="backdrop">
        <div class="modal">
            <p><b>Hi</b><br><br>Akhand here,<br>I would like ThoughtWorks to know<br>that I had fun doing this challenge.<br><br>Here are some more fun things I did</p>
            <br><br>
            <a href="https://contrevien.github.io/word-beater" target="_blank" class="showoff">Typing Game</a>
            <br><br><br><br>
            <a id="weather" href="https://contrevien.github.io/weather-cards" target="_blank" class="showoff">Weather App</a>
            <br><br><br><br>
            <a id="github" href="https://github.com/Contrevien" target="_blank" class="showoff">My Github</a>
            <br><br><br>
            <p style="font-size: 10px;">Click outside this box to close</p>
        </div>
    </div>
    

    <footer>Made with passion by <del>Akhand</del></footer>
    <script>

        // Fetching the content onload
        let movies = [];
        let autocompleteList = [];
        let sortBy = 0;
        let countries = [];

        window.onload = () => {
            //show loader
            let loader = document.getElementById("loader-container");
            loader.style.display = "flex";

            //load content
            let xhr = new XMLHttpRequest();
            xhr.open('GET','http://starlord.hackerearth.com/movieslisting', true);
            xhr.onload = function(){
                loader.style.display = "none"; 
                if (this.status === 200 || this.readyState === 4) {
                    movies = JSON.parse(this.responseText);
                    for (let movie in movies){
                        movies[movie]["popularity"] = parseInt(movie)+1;
                        autocompleteList.push(movies[movie]["movie_title"]);
                        if (movies[movie]["country"] === "" && countries.indexOf("Others") === -1)
                            countries.push("Others");
                        else if (countries.indexOf(movies[movie]["country"]) === -1 && movies[movie]["country"] !== "")
                            countries.push(movies[movie]["country"]);
                    }
                    loadFilters();
                    displayMovies(movies);
                }
                else {
                    alert("Something Went Wrong, please reload!");
                }
            }
            xhr.send();
        }



        // utility function to show movies
        displayMovies = (movies) => {
            for (let movie in movies) {
                //console.log(movie);
                
                /*create movie-card*/
                let movieCard = document.createElement("div");
                movieCard.setAttribute("class", "movie-card");

                let serial = document.createElement("div");
                serial.setAttribute("class", "serial");
                serial.innerHTML = (parseInt(movie)+1).toString();
                movieCard.appendChild(serial);

                let movieName = document.createElement("div");
                movieName.setAttribute("class", "name");
                if (movies[movie]["title_year"] === "")
                    movies[movie]["title_year"] = "NA"; 
                movieName.innerHTML ="<a href='" + movies[movie]["movie_imdb_link"] + "' target='_blank'>" + movies[movie]["movie_title"] + "(" + movies[movie]["title_year"] + ")</a>";
                movieCard.appendChild(movieName);

                let genre = document.createElement("div");
                genre.setAttribute("class", "genre");
                genre.innerHTML = movies[movie]["genres"].split("|").join(", ");
                movieCard.appendChild(genre);

                let actors = document.createElement("div");
                actors.setAttribute("class", "actors");
                actors.innerHTML = movies[movie]["actor_1_name"] + ", " + movies[movie]["actor_2_name"];
                movieCard.appendChild(actors);

                let lang = document.createElement("div");
                lang.setAttribute("class", "lang");
                if (movies[movie]["language"] === "")
                    movies[movie]["language"] = "NA"; 
                lang.innerHTML = movies[movie]["language"];
                movieCard.appendChild(lang);

                let country = document.createElement("div");
                country.setAttribute("class", "country");
                if (movies[movie]["country"] === "")
                    movies[movie]["country"] = "NA"; 
                country.innerHTML = movies[movie]["country"];
                movieCard.appendChild(country);

                let director = document.createElement("div");
                director.setAttribute("class", "director");
                director.innerHTML = "<b>Director: </b>" + movies[movie]["director_name"];
                movieCard.appendChild(director);

                let budget = document.createElement("div");
                budget.setAttribute("class", "budget");
                if (movies[movie]["budget"] === "")
                    movies[movie]["budget"] = "<b>Budget: </b>" + "NA"; 
                budget.innerHTML = "<b>Budget: </b>" + movies[movie]["budget"];
                movieCard.appendChild(budget);

                let link = document.createElement("div");
                link.setAttribute("class", "link");
                link.innerHTML = "Click on the name to view more";
                movieCard.appendChild(link);

                /*append the card to DOM*/
                document.getElementsByTagName("section")[0].appendChild(movieCard);

                /* Adding event Listener for expand property */
                movieCard.addEventListener("click", expand);
            }
        }


        /* Function to expand or contract height of movie tiles */
        expand = (e) => {
            let target = e.target.parentNode;
            if (target.style.maxHeight == "90px")
                target.style.maxHeight = "270px";
            else
                target.style.maxHeight = "90px";
        }


        /* Sort Functions */
        let popularBut = document.getElementById("popular");
        let latestBut = document.getElementById("latest");

        sort = (e) => {
            let section = document.getElementsByTagName("section")[0];
            if(section.querySelector("goBack") != null){
                section.removeChild(document.getElementById("goBack"));
            }
            while(section.firstChild)
                    section.removeChild(section.firstChild);
            if (e.srcElement.id === "popular" && !e.srcElement.classList.contains("active")){
                popularBut.classList.add("active");
                latestBut.classList.remove("active");
                movies.sort((a, b) => {
                    if(a["popularity"] > b["popularity"]) return 1;
                    if(a["popularity"] < b["popularity"]) return -1;
                    return 0;
                })
            }
            else if (e.srcElement.id === "latest" && !e.srcElement.classList.contains("active")){
                latestBut.classList.add("active");
                popularBut.classList.remove("active");
                movies.sort((a, b) => {
                    if (b["title_year"] === "NA") return -1;
                    if (a["title_year"] === "NA") return 1; 
                    if(a["title_year"] < b["title_year"]) return 1;
                    if(a["title_year"] > b["title_year"]) return -1;
                    return 0;
                })
            }
            displayMovies(movies);
        }

        popularBut.addEventListener("click", sort);
        latestBut.addEventListener("click", sort);


        /* search implementation */
        // let searchBar = document.getElementById("search");
        // searchBar.oninput = () => {
        //     let section = document.getElementsByTagName("section")[0];
        //     while(section.firstChild)
        //             section.removeChild(section.firstChild);
        //     let searchedMovies = [];
        //     let temp = searchBar.value.toLowerCase();
        //     let searchValue = temp.charAt(0).toUpperCase() + temp.slice(1);
        //     for (let movie in movies){
        //         if (movies[movie]["movie_title"].includes(searchValue)){
        //             searchedMovies.push(movies[movie]);
        //         }
        //     }
        //     displayMovies(searchedMovies);
        // }


        /* Scroll Back to Top */
        let section = document.getElementsByTagName("section")[0];
        document.getElementById("backToTop").onclick = () => {
            section.scrollTop = 0;
        }


        /* AutoComplete Functionality */

        function searchAndDisplay(str) {
            str = str.replace(/\s+/g,'');
            for (let movie in movies) {
                if (movies[movie]["movie_title"].replace(/\s+/g,'') === str){
                    let section = document.getElementsByTagName("section")[0];
                    while(section.firstChild)
                            section.removeChild(section.firstChild);
                    displayMovies([movies[movie]]);
                    let goBack = document.createElement("button");
                    goBack.setAttribute("class", "sort");
                    goBack.setAttribute("id", "goBack");
                    goBack.innerHTML = "Back";
                    goBack.addEventListener("click", () => {
                        document.getElementById("search").value = "";
                        document.getElementById("popular").click();
                        document.getElementById("search").focus();
                    })
                    section.appendChild(goBack);
                    break;
                }
            }
        }

        function autocomplete(inp, arr) {
            let currentFocus;
            inp.addEventListener("input", function(e) {
                let a, b, i, val = this.value;
                closeAllLists();
                if (!val) { return false;}
                currentFocus = -1;
                a = document.createElement("DIV");
                a.setAttribute("id", this.id + "autocomplete-list");
                a.setAttribute("class", "autocomplete-items");
                this.parentNode.appendChild(a);
                for (i = 0; i < arr.length; i++) {
                if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                    b = document.createElement("DIV");
                    b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                    b.innerHTML += arr[i].substr(val.length);
                    b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                        b.addEventListener("click", function(e) {
                        inp.value = this.getElementsByTagName("input")[0].value;
                        searchAndDisplay(inp.value);
                        closeAllLists();
                    });
                    a.appendChild(b);
                }
                }
            });
            inp.addEventListener("keydown", function(e) {
                let x = document.getElementById(this.id + "autocomplete-list");
                if (x) x = x.getElementsByTagName("div");
                if (e.keyCode == 40) {
                currentFocus++;
                addActive(x);
                } else if (e.keyCode == 38) { //up
                currentFocus--;
                addActive(x);
                } else if (e.keyCode == 13) {
                e.preventDefault();
                if (currentFocus > -1) {
                    if (x) x[currentFocus].click();
                }
                }
            });
            function addActive(x) {
            if (!x) return false;
            removeActive(x);
            if (currentFocus >= x.length) currentFocus = 0;
            if (currentFocus < 0) currentFocus = (x.length - 1);
            x[currentFocus].classList.add("autocomplete-active");
            }
            function removeActive(x) {
            for (let i = 0; i < x.length; i++) {
                x[i].classList.remove("autocomplete-active");
            }
            }
            function closeAllLists(elmnt) {
            let x = document.getElementsByClassName("autocomplete-items");
            for (let i = 0; i < x.length; i++) {
                if (elmnt != x[i] && elmnt != inp) {
                x[i].parentNode.removeChild(x[i]);
            }
            }
        }

        document.addEventListener("click", function (e) {
            closeAllLists(e.target);
        });
        }

        autocomplete(document.getElementById("search"), autocompleteList);


        /* Utility to handle the upper-container */

        let s = document.getElementById("opener");
        let header = document.getElementById("upper-container");
        let arrow = document.getElementById("open");

        slide = () => {
            let offset = window.innerWidth > 1290 ? 75 : (window.innerWidth > 865 ? 144 : 215.5 );
            if(header.style.top === "") {
                header.style.top = "-" + offset + "px";
                s.style.marginTop = "-" + (offset+30) + "px";
                arrow.style.transform = "rotate(0deg)";
            }
            else {
                header.style.top = "";
                s.style.marginTop = "-30px";
                arrow.style.transform = "rotate(180deg)";
            }
        }
        s.addEventListener("click", slide);


        /* Styling Backdrop & Modal */
        let footer = document.getElementsByTagName("footer")[0];
        let backdrop = document.getElementsByClassName("backdrop")[0];
        let me = document.getElementById("me");

        me.addEventListener("click", () => {
            footer.style.display = "block";
            backdrop.style.display = "flex";
        })


        backdrop.addEventListener("click", () => {
            backdrop.style.display = "none";
            footer.style.display = "none";
        })



        /* Filter Manipulation */

        let cou = document.getElementById("country");
        cou.addEventListener("click", () => {
            if (document.getElementsByClassName("filter-items")[1].style.display === "none") {
                s.removeEventListener("click",slide);
                document.getElementsByClassName("filter-items")[1].style.display = "block";
            }
            else {
                document.getElementsByClassName("filter-items")[1].style.display = "none";
                s.addEventListener("click", slide);
                cou.style.backgroundColor = "white";
            }
        })


        function loadFilters() {
            let saved = null;
            let div = document.createElement("div");
            div.innerHTML = "None";
            div.addEventListener("click", byCountry);
            document.getElementsByClassName("filter-items")[1].appendChild(div);
            for (let country in countries) {
                let div = document.createElement("div");
                div.innerHTML = countries[country];
                if(countries[country] !== "Others")
                    document.getElementsByClassName("filter-items")[1].appendChild(div);
                else
                    saved = div;
                div.addEventListener("click", byCountry);
            }
            document.getElementsByClassName("filter-items")[1].appendChild(saved);
        }

        function byCountry(e) {
            let key = e.srcElement.innerHTML;
            e.srcElement.parentNode.style.display = "none"; 
            let section = document.getElementsByTagName("section")[0];
            while(section.firstChild)
                    section.removeChild(section.firstChild);
            if (key==="None"){
                displayMovies(movies);
                cou.style.backgroundColor = "white";
                s.addEventListener("click", slide);
                return;
            }
            if (key === "Others"){
                key = "NA";
            }
            let newMovies = [];
            
            
            for (let movie in movies) {
                if(movies[movie]["country"] === key){
                    newMovies.push(movies[movie]);
                }
            }
            cou.style.backgroundColor = "#67e2ef";
            s.addEventListener("click", slide);
            displayMovies(newMovies);
            cou.innerHTML = key;

        }

    </script>
</body>
</html>